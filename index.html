<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ariya charge % calculator</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="EV % Calc">
<meta name="theme-color" content="#ffffff">
<meta name="color-scheme" content="light dark">

<style>
  :root { --pad:14px; --radius:12px; --font: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; }
  html { -webkit-text-size-adjust: 100%; }
  body { font-family: var(--font); margin:0; padding:0; background:#f6f7f9; color:#0f172a; }
  .wrap { max-width:680px; margin:40px auto; padding:0 var(--pad); }
  .card { background:#fff; border-radius:var(--radius); box-shadow:0 1px 3px rgba(0,0,0,.08),0 10px 24px rgba(0,0,0,.06); padding:calc(var(--pad)*1.25); transition:background .2s,color .2s,border-color .2s; }
  .card.danger { background:#b91c1c; color:#fff; }
  h1 { font-size:1.25rem; margin:0; }

  .topbar {
    display: flex;
    justify-content: flex-start; /* left align the swap button */
    margin: 6px 0 12px;
  }
  .btn {
    border:1px solid #cbd5e1; background:#fff; padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;
  }
  .btn:active { transform: translateY(1px); }

  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:10px 0 6px; }
  label { display:block; font-weight:600; font-size:.9rem; margin-bottom:6px; }
  input[type="number"]{
    width:100%; font-size:16px; padding:6px 8px;
    border:1px solid #cbd5e1; border-radius:6px; outline:none;
    background:#fff; color:#0f172a; -webkit-appearance:none; appearance:none;
  }
  .card.danger input[type="number"]{ background:#fee2e2; border-color:#fecaca; color:#7f1d1d; }
  input[type="number"]:focus{ border-color:#64748b; }
  .muted{ color:#64748b; font-size:.9rem; }
  .card.danger .muted{ color:#fde68a; }

  .result{ margin-top:18px; padding:18px; background:#f1f5f9; border-radius:12px; text-align:center; }
  .card.danger .result{ background:rgba(255,255,255,.12); }
  .result .big{ font-size:2rem; line-height:1.2; }
  .result .big strong{ font-weight:800; }
  .warn{ margin-top:8px; font-size:.95rem; text-align:center; display:none; }
  .card.danger .warn{ display:block; font-weight:700; }

  /* Efficiency block */
  .eff{ margin-top:12px; padding:12px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; }
  .card.danger .eff{ background:rgba(255,255,255,.12); border-color:rgba(255,255,255,.25); }
  .inline{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .chip{ border:1px solid #cbd5e1; border-radius:999px; padding:6px 10px; background:#fff; font-weight:600; cursor:pointer; }
  .chip:active{ transform:translateY(1px); }
  .card.danger .chip{ background:#fff; color:#7f1d1d; }

  /* Desktop: keep inputs compact */
  @media (min-width:768px){ input[type="number"]{ max-width:140px; display:inline-block; } }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <h1>Ariya Charge % Calculator</h1>

      <div class="topbar">
        <button class="btn" id="swapBtn" aria-pressed="false" title="Swap input/output">Swap: miles → %</button>
      </div>

      <div class="grid">
        <div>
          <label for="miles" id="milesLabel">Trip distance (miles)</label>
          <input type="number" id="miles" placeholder="e.g., 120" min="0" step="1" inputmode="numeric">
        </div>
        <div>
          <label for="buffer">Arrival range (miles)</label>
          <input type="number" id="buffer" value="10" min="0" step="1" inputmode="numeric">
          <div class="muted">Recommended minimum: 10 miles.</div>
        </div>
      </div>

      <div class="result" id="out" aria-live="polite">
        <span class="big" id="forwardText">Charge to <strong id="pct">--%</strong></span>
        <span class="big" id="reverseText" style="display:none;">Plan for ~<strong id="milesOut">--</strong> miles</span>
        <div class="warn" id="cap">Unable to make trip at 100%.</div>
      </div>

      <!-- Efficiency control -->
      <div class="eff">
        <label for="eff">Planning efficiency (miles per 1%)</label>
        <div class="inline">
          <input type="number" id="eff" value="2.5" min="1.0" max="4.0" step="0.05" inputmode="decimal">
          <button class="chip" data-eff="2.5" title="Observed">2.5 observed</button>
          <button class="chip" data-eff="2.25" title="Conservative">2.25 conservative</button>
        </div>
        <div class="muted">Default 2.5. Use 2.25 for conservative planning.</div>
      </div>
    </div>
  </div>

<script>
(function(){
  const miles  = document.getElementById('miles');
  const milesLabel = document.getElementById('milesLabel');
  const buffer = document.getElementById('buffer');
  const pctOut = document.getElementById('pct');
  const milesOut = document.getElementById('milesOut');
  const card   = document.getElementById('card');
  const cap    = document.getElementById('cap');
  const effInp = document.getElementById('eff');
  const chips  = document.querySelectorAll('.chip');
  const swapBtn= document.getElementById('swapBtn');
  const forwardText = document.getElementById('forwardText');
  const reverseText = document.getElementById('reverseText');

  const saved = JSON.parse(localStorage.getItem('ariyacalc') || '{}');
  if (saved.miles  != null) miles.value  = saved.miles;
  if (saved.buffer != null) buffer.value = saved.buffer; else buffer.value = 10;
  if (saved.eff    != null) effInp.value = saved.eff;    else effInp.value = 2.5;

  let reverse = saved.mode === 'reverse';
  updateModeUI();

  function compute(){
    const buf = Number(buffer.value || 0);
    const eff = Number(effInp.value || 2.5);

    localStorage.setItem('ariyacalc', JSON.stringify({
      miles: miles.value === "" ? "" : Number(miles.value),
      buffer: buf,
      eff,
      mode: reverse ? 'reverse' : 'forward'
    }));

    if (!reverse){
      const m = (miles.value === "" ? NaN : Number(miles.value));
      if (isNaN(m)) {
        pctOut.textContent = "--%";
        card.classList.remove('danger'); cap.style.display = "none";
        return;
      }
      let pct = (m + buf) / eff;
      pct = Math.ceil(pct);
      const exceeds = pct > 100;
      pctOut.textContent = pct + "%";
      if (exceeds) { card.classList.add('danger'); cap.style.display = "block"; }
      else { card.classList.remove('danger'); cap.style.display = "none"; }
    } else {
      const p = (miles.value === "" ? NaN : Number(miles.value));
      if (isNaN(p)) {
        milesOut.textContent = "--";
        card.classList.remove('danger'); cap.style.display = "none";
        return;
      }
      const mOut = Math.max(0, Math.floor((p * eff) - buf));
      milesOut.textContent = mOut;
      card.classList.remove('danger'); cap.style.display = "none";
    }
  }

  function updateModeUI(){
    if (!reverse){
      swapBtn.textContent = "Swap: miles → %";
      milesLabel.textContent = "Trip distance (miles)";
      miles.placeholder = "e.g., 120";
      forwardText.style.display = "";
      reverseText.style.display = "none";
    } else {
      swapBtn.textContent = "Swap: % → miles";
      milesLabel.textContent = "Charge % available";
      miles.placeholder = "e.g., 65";
      forwardText.style.display = "none";
      reverseText.style.display = "";
    }
    compute();
  }

  swapBtn.addEventListener('click', () => {
    reverse = !reverse;
    updateModeUI();
  });

  [miles, buffer, effInp].forEach(el => el.addEventListener('input', compute));
  chips.forEach(btn => btn.addEventListener('click', () => { effInp.value = btn.dataset.eff; compute(); }));
  compute();
})();
</script>
</body>
</html>
